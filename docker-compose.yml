version: '3.8'

services:
  ocr-processor:
    build: .
    container_name: pdfautomagic
    user: "${PUID:-1000}:${PGID:-1000}"
    volumes:
      # Mount the PDF directory (containing unprocessed, processed, originals)
      - ${SCAN_DIR}:/scans
      # Mount config directory (contains rclone.conf and post-scan-commands/)
      - ${CONFIG_DIR}:/config:ro
    environment:
      - TZ=${TIMEZONE:-UTC}
      - RCLONE_REMOTE=${RCLONE_REMOTE:-Dropbox:Cabinet/Documents}
      - INTERVAL_MINUTES=${INTERVAL_MINUTES:-1}
      - MAX_PARALLEL_JOBS=${MAX_PARALLEL_JOBS:-1}
      - MINUTES_OLD=${MINUTES_OLD:-2}
    restart: unless-stopped

  # Watchtower: Automatically updates Docker images
  # Uncomment to enable automatic updates
  # watchtower:
  #   image: containrrr/watchtower
  #   container_name: watchtower
  #   restart: unless-stopped
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock
  #   environment:
  #     - WATCHTOWER_CLEANUP=true
  #     - WATCHTOWER_INCLUDE_RESTARTING=true
  #     - WATCHTOWER_SCHEDULE=0 0 4 * * *  # Daily at 4 AM
  #   command: pdfautomagic  # Only watch PDFAutomagic container
